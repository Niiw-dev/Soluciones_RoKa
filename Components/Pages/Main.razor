@page "/"
@using RoKa.Components.Pages
@using RoKa.Models
@using System.ComponentModel.DataAnnotations
@inject HttpClient Http
@inject IHttpClientFactory HttpClientFactory
@inject IJSRuntime Js
@inject ILogger<Main> Logger
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>ROKA | Constructora de Innovacion</PageTitle>

<link rel="stylesheet" href="css/styles.css">

<header class="header">
    <a href="#home" style="text-decoration: none;">
    <div style="text-align: left; line-height: 1; margin: 0; padding: 0;" href="#home">
        <span style="
            display: block;
            margin: 0 0 -10px 2px;
            font-size: 1.22rem;
            transform: scaleY(0.78);
            transform-origin: top;
            color: #ffffff;
        ">Soluciones</span>

        <span style="
            display: block;
            margin: 0;
            font-size: 3rem;
            font-weight: bold;
            color: var(--neon-green);
            text-shadow: 0 0 10px rgba(57, 255, 20, 0.7);
        ">RoKa</span>
    </div>
    </a>

    <nav class="navbar" id="navbar">
        <a href="#home" @onclick="CloseMenu">Inicio</a>
        <a href="#services" @onclick="CloseMenu">Servicios</a>
        <a href="#numbers" @onclick="CloseMenu">Nosotros</a>
        <a href="#projects" @onclick="CloseMenu">Proyectos</a>
        <a href="#testimonials" @onclick="CloseMenu">Testimonios</a>
        <a href="#contact" @onclick="CloseMenu">Contacto</a>
    </nav>
    <div class="menu-icon" id="menu-icon" @onclick="ToggleMenu">‚ò∞</div>
</header>

<section class="hero" id="home" style="">
    
    <img src="images/fondo.png" alt="Imagen de construcci√≥n moderna" class="hero-bg">
    <div class="hero-content">
        <h1>Construyendo el <span class="highlight">Futuro</span> de tu Visi√≥n</h1>
        <p>ROKA trae soluciones a tu vida, con respaldo y garant√≠a en nuestro servicio.</p>
        <a href="#contact" class="btnII">Solicitar Presupuesto</a>
    </div>
</section>

<section class="sectionII services" id="services">
    <h2 class="section-title">Nuestros Servicios</h2>
    <div class="scroll-wrapper" id="scrollWrapper" style="overflow-x: auto;">
        <div class="services-container">
            <div class="service-card">
                <div class="service-icon">üè¢</div>
                <h3>Obra Civil</h3>
                <p>Realizamos todo tipo de trabajos de construcci√≥n, desde estructuras nuevas hasta adecuaciones, garantizando calidad, seguridad y cumplimiento.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">üè°</div>
                <h3>Remodelaciones</h3>
                <p>Dale un nuevo aire a tu hogar o negocio. Redise√±amos y mejoramos interiores y exteriores seg√∫n tus necesidades.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">üîß</div>
                <h3>Cubiertas en Policarbonato</h3>
                <p>Instalamos cubiertas modernas y resistentes que brindan iluminaci√≥n sin comprometer la protecci√≥n contra el clima.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">üöΩ</div>
                <h3>Divisiones de Ba√±o</h3>
                <p>Fabricamos e instalamos divisiones elegantes y funcionales en vidrio templado o acr√≠lico, adaptadas a tu espacio.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">‚ö°</div>
                <h3>Electricidad Residencial</h3>
                <p>Dise√±amos e instalamos sistemas el√©ctricos eficientes, seguros y adaptados a las normas vigentes.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">üõãÔ∏èÔ∏è</div>
                <h3>Muebles con Alma de Hierro</h3>
                <p>Creamos muebles personalizados que combinan hierro estructural y acabados de alta calidad para espacios modernos y duraderos.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">üõ†Ô∏èÔ∏è</div>
                <h3>Carpinter√≠a Met√°lica</h3>
                <p>Fabricamos estructuras, puertas, ventanas y acabados en metal con precisi√≥n y estilo, adaptados a tu proyecto.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">üí°</div>
                <h3>Sistemas Electr√≥nicos</h3>
                <p>Dise√±amos e instalamos sistemas de automatizaci√≥n, alarmas, c√°maras y control electr√≥nico para tus espacios.</p>
            </div>
        </div>
    </div>
</section>

<section class="section stats" id="numbers">
    <h2 class="section-title1">N√∫meros RoKa</h2>
    <div class="stats-container">
        <div class="stat-item" style="grid-column: 1">
            <div class="stat-number" data-target="500+">0</div>
            <div class="stat-text">Proyectos Completados</div>
        </div>
        <div class="stat-item" style="grid-column: 2">
            <div class="stat-number" data-target="12">0</div>
            <div class="stat-text">A√±os de Experiencia</div>
        </div>
        <div class="stat-item" style="grid-column: 3">
            <div class="stat-number" data-target="96%">0</div>
            <div class="stat-text">Clientes Satisfechos</div>
        </div>
        <div class="stat-item1" style="grid-column: 4">
            <div class="stat-number" data-target="5">0</div>
            <div class="stat-text">Profesionales Expertos</div>
        </div>
    </div>
</section>

@if (isModalOpen)
{
    <GaleriaModal OnClose="CloseModal" />
}
<section class="section projects" id="projects">
    <h2 class="section-title">Nuestros Trabajos</h2>

    <div class="projects-container">
        <a href="#" @onclick="ShowModal" @onclick:preventDefault style="text-decoration: none;color: #ffffff">
            <div class="project-card">
                <img src="images/lampara.png" alt="Proyecto Comercial" class="project-img">
                <div class="project-overlay">
                    <h3>Lamparas</h3>
                    <p>Dale un toque sofisticado a tu hogar con estas estructuras modernas. Ideales para iluminar tus espacios con estilo y car√°cter.</p>
                </div>
            </div>
        </a>
        <a href="#" @onclick="ShowModal" @onclick:preventDefault style="text-decoration: none; color: #ffffff">
            <div class="project-card">
                <img src="images/cubierta.jpg" alt="Proyecto Residencial" class="project-img">
                <div class="project-overlay">
                    <h3>Cubiertas</h3>
                    <p>Protege y decora tu hogar con cubiertas de calidad, dise√±adas para durar y darle un toque elegante a tu espacio.</p>
                </div>
            </div>
        </a>
        <a href="#" @onclick="ShowModal" @onclick:preventDefault style="text-decoration: none;color: #ffffff">
            <div class="project-card">
                <img src="images/mesas.png" alt="Proyecto Industrial" class="project-img">
                <div class="project-overlay">
                    <h3>Mesas</h3>
                    <p>Haz de tus reuniones algo especial con estas mesas √∫nicas, que combinan dise√±o y diversi√≥n para crear momentos inolvidables.</p>
                </div>
            </div>
        </a>
        <a href="#" @onclick="ShowModal" @onclick:preventDefault style="text-decoration: none;color: #ffffff">
            <div class="project-card">
                <img src="images/asientos.png" class="project-img" alt="">
                <div class="project-overlay">
                    <h3>Asientos</h3>
                    <p>Renueva tu ambiente con estas sillas de dise√±o industrial. Perfectas para destacar en cualquier espacio con estilo y funcionalidad.</p>
                </div>
            </div>
        </a>
        <a href="#" @onclick="ShowModal" @onclick:preventDefault style="text-decoration: none;color: #ffffff">
            <div class="project-card">
                <img src="images/electronica.jpg" class="project-img" alt="">
                <div class="project-overlay">
                    <h3>Sistemas Electr√≥nicos</h3>
                    <p>Integra tecnolog√≠a en tus espacios con sistemas electr√≥nicos modernos, funcionales y dise√±ados para simplificar tu vida.</p>
                </div>
            </div>
        </a>
    </div>
</section>

<section class="section cta">
    <h2>¬øListo para Hacer Realidad tu Proyecto?</h2>
    <p>Perm√≠tenos transformar tus ideas en construcciones excepcionales. Nuestro equipo est√° preparado para llevar tu visi√≥n al siguiente nivel.</p>
    <a href="#contact" class="btnII">Cont√°ctanos Hoy</a>
</section>

<section class="section testimonials" id="testimonials">
    <h2 class="section-title">Lo Que Dicen Nuestros Clientes</h2>
    <div class="testimonials-container">
        <div class="testimonial-card card-left">
            <p class="testimonial-text">ROKA super√≥ todas nuestras expectativas. Su enfoque innovador y atenci√≥n al detalle transformaron nuestra visi√≥n en una realidad impresionante.</p>
            <div class="testimonial-author">
                <div>
                    <div class="author-name" style="text-align: end">Mar√≠a Gonz√°lez</div>
                    <div class="author-title">Gerente de Proyectos, Desarrollos Urbanos</div>
                </div>
                <img src="images/user.png" alt="Avatar" class="author-avatar">
            </div>
        </div>
        <div class="testimonial-card card-center">
            <p class="testimonial-text">La calidad de construcci√≥n y el enfoque sostenible de ROKA nos permiti√≥ obtener la certificaci√≥n que busc√°bamos. Su experiencia en construcci√≥n verde es inigualable.</p>
            <div class="testimonial-author">
                <div>
                    <div class="author-name" style="text-align: end">Mar√≠a Gonz√°lez</div>
                    <div class="author-title">Gerente de Proyectos, Desarrollos Urbanos</div>
                </div>
                <img src="images/femaleuser.png" alt="Avatar" class="author-avatar">
            </div>
        </div>
        <div class="testimonial-card card-right">
            <p class="testimonial-text">La profesionalidad y compromiso del equipo de ROKA hizo que nuestro proyecto se completara a tiempo y dentro del presupuesto. Definitivamente trabajaremos con ellos nuevamente.</p>
            <div class="testimonial-author">
                <div>
                    <div class="author-name" style="text-align: end">Mar√≠a Gonz√°lez</div>
                    <div class="author-title">Gerente de Proyectos, Desarrollos Urbanos</div>
                </div>
                <img src="images/usernpc.png" alt="Avatar" class="author-avatar">
            </div>
        </div>
    </div>
</section>

<section class="section contact" id="contact">
    <h2 class="section-title">Ponte en Contacto</h2>
    <div class="contact-container">
        <div class="contact-info">
            <div class="info-inner">
                <h3>Informaci√≥n de Contacto</h3>
                <a href="https://wa.me/573102593593?text=Hola%2C%20quiero%20m√°s%20informaci√≥n%20sobre%20sus%20servicios"
                   target="_blank" style="text-decoration: none; color: #ffffff">
                    <p>
                        <img src="images/whatsapp.png" style="width: 1.73rem; margin-right: 0.5rem" alt="">
                        +57 310 259 3593
                    </p>
                </a>

                <a href="https://www.facebook.com/solucionesroka" target="_blank" style="text-decoration: none; color: #ffffff">
                    <p><img src="images/facebook.png" style="width: 1.7rem; margin-right: 0.5rem" alt=""> Soluciones Roka-muebles</p>
                </a>

                <a href="mailto:rodrigo.fernandez2@hotmail.com" style="text-decoration: none; color: #ffffff">
                    <p><span style="font-size: 1.5rem; margin-right: 0.5rem"> ‚úâÔ∏è </span> rodrigo.fernandez2@hotmail.com</p>
                </a>
                
                <p style="margin-bottom: 0"><span style="font-size: 1.5rem; margin-right: 0.5rem">‚è∞</span> Lunes - Viernes: 7:00 AM - 6:00 PM </p>
                <p style="margin-left: 3rem;margin-top: 0">/ S√°bados: 10:00 AM - 4:00 PM</p>
            </div>
        </div>
        <div class="contact-form">
            <h3>Env√≠anos un Mensaje</h3>
            <EditForm Model="@contactForm"
                      OnValidSubmit="HandleValidSubmit"
                      FormName="ContactForm"
                      Enhance="true">

                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="form-group">
                    <label for="name">Nombre</label>
                    <InputText id="name" class="form-control" autocomplete="name"
                               @bind-Value="contactForm.Name" />
                    <ValidationMessage For="@(() => contactForm.Name)" />
                </div>

                <div class="form-group">
                    <label for="email">Correo Electr√≥nico</label>
                    <InputText id="email" class="form-control" autocomplete="email"
                               @bind-Value="contactForm.Email" />
                    <ValidationMessage For="@(() => contactForm.Email)" />
                </div>

                <div class="form-group">
                    <label for="phone">Tel√©fono</label>
                    <InputText id="phone" class="form-control" autocomplete="tel"
                               @bind-Value="contactForm.Phone" />
                </div>

                <div class="form-group">
                    <label for="subject">Asunto</label>
                    <InputText id="subject" class="form-control"
                               @bind-Value="contactForm.Subject" />
                    <ValidationMessage For="@(() => contactForm.Subject)" />
                </div>

                <div class="form-group">
                    <label for="message">Mensaje</label>
                    <InputTextArea id="message" class="form-control"
                                   @bind-Value="contactForm.Message" />
                    <ValidationMessage For="@(() => contactForm.Message)" />
                </div>

                <button type="submit"
                        class="btnII @(isSubmitting ? "btn-disabled" : "btn-primary")"
                        disabled="@isSubmitting">
                    @submitButtonText
                </button>


                @if (showSuccessMessage)
                {
                    <div class="alert @(showAlert ? "alert-danger" : "alert-success") mt-2">
                        @messageAlert
                    </div>
                }
            </EditForm>
        </div>
    </div>
</section>

<footer class="footer">
    <div class="footer-container">
        <div class="footer-col">
            <div style="display: flex">
            <img src="images/Logo.png" alt="Avatar" class="author-avatar">
            <h4>Sobre <span class="red-accent">RoKa</span></h4>
            </div><br/>
            <p>Transformamos espacios con soluciones innovadoras que combinan funcionalidad, est√©tica y sostenibilidad.</p>
        </div>
        <div class="footer-col">
            <h4>Enlaces R√°pidos</h4>
            <ul class="footer-links">
                <li><a href="#home">Inicio</a></li>
                <li><a href="#services">Servicios</a></li>
                <li><a href="#projects">Proyectos</a></li>
                <li><a href="#numbers">Nosotros</a></li>
                <li><a href="#contact">Contacto</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Servicios</h4>
            <ul class="footer-links">
                <li><a href="#">Obra Civil</a></li>
                <li><a href="#">Remodelaciones</a></li>
                <li><a href="#">Cubiertas en Policarbonato</a></li>
                <li><a href="#">Divisiones de Ba√±o</a></li>
                <li><a href="#">Electricidad Residencial</a></li>
                <li><a href="#">Muebles con Alma de Hierro</a></li>
                <li><a href="#">Carpinter√≠a Met√°lica</a></li>
                <li><a href="#">Sistemas Electr√≥nicos</a></li>
            </ul>
        </div>
    </div>
</footer>

<script src="js/script.js"></script>
<script src="js/numbers.js"></script>
<script src="js/menu.js"></script>

@code {
    private bool isModalOpen = false;
    private bool isSubmitting = false;
    private bool showSuccessMessage = false;
    private bool showAlert = false;

    private string messageAlert = "¬°Gracias! Tu mensaje ha sido enviado";
    private string submitButtonText = "Enviar mensaje";

    private ContactFormModel contactForm = new();

    private void ShowModal() => isModalOpen = true;
    private void CloseModal() => isModalOpen = false;

    private async Task HandleValidSubmit()
    {
        isSubmitting = true;
        submitButtonText = "Enviando...";
        showSuccessMessage = false;
        await InvokeAsync(StateHasChanged);

        try
        {
            var email = new EmailRequest
            {
                ToEmail = "correaedwin159@gmail.com",
                Subject = $"Nuevo contacto: {contactForm.Subject}",
                Message = BuildEmailMessage(contactForm),
                FromName = contactForm.Name ?? "",
                FromEmail = contactForm.Email ?? ""
            };

            var client = HttpClientFactory.CreateClient("MiApi");
            var response = await client.PostAsJsonAsync("api/email/send", email);

            if (response.IsSuccessStatusCode)
            {
                showSuccessMessage = true;
                contactForm = new();
            }
            else
            {
                await ShowTemporaryAlert($"Fall√≥ el env√≠o. C√≥digo: {response.StatusCode}");
            }
        }
        catch (Exception ex)
        {
            await ShowTemporaryAlert($"Error al enviar el correo: {ex.Message}");
        }
        finally
        {
            isSubmitting = false;
            submitButtonText = "Enviar mensaje";
            await InvokeAsync(StateHasChanged);
            await Task.Delay(5000);
            showSuccessMessage = false;
        }
    }

    private static string BuildEmailMessage(ContactFormModel model) =>
        $"Has recibido un nuevo mensaje de contacto:\n\n" +
        $"Nombre: {model.Name}\n" +
        $"Email: {model.Email}\n" +
        $"Tel√©fono: {model.Phone}\n\n" +
        $"Mensaje:\n{model.Message}";

    private async Task ShowTemporaryAlert(string message)
    {
        showAlert = true;
        messageAlert = message;
        showSuccessMessage = true;
        await Task.Delay(5000);
        showSuccessMessage = false;
        showAlert = false;
        messageAlert = "¬°Gracias! Tu mensaje ha sido enviado";
    }

    public class ContactFormModel
    {
        [Required(ErrorMessage = "El nombre es obligatorio")]
        public string? Name { get; set; }

        [Required(ErrorMessage = "El correo es obligatorio")]
        [EmailAddress(ErrorMessage = "Correo inv√°lido")]
        public string? Email { get; set; }

        public string? Phone { get; set; }

        [Required(ErrorMessage = "El asunto es obligatorio")]
        public string? Subject { get; set; }

        [Required(ErrorMessage = "El mensaje es obligatorio")]
        public string? Message { get; set; }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if (firstRender) { await Js.InvokeVoidAsync("startStatAnimation"); } }

    private async Task ToggleMenu() { await Js.InvokeVoidAsync("toggleNavbar"); }

    private async Task CloseMenu() { await Js.InvokeVoidAsync("closeNavbar"); }
}


